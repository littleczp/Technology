# 虚拟化

程序运行时会发生什么?

从内存中获取一条指令（fetch） => 解码（decode） => 执行 (execute） => loop



{% tabs %}
{% tab title="虚拟化cpu" %}
在硬件的帮助下，将单个CPU转换为看似无限数量的CPU，从而让许多程序看似同时运行
{% endtab %}

{% tab title="虚拟化内存" %}
使得每个正在运行的程序都有自己的私有内存 -> 以某种方式映射道机器的物理内存上
{% endtab %}
{% endtabs %}



增加共享计数器需要3条指令

1. 将计数器的值从内存加载到寄存器（内存->寄存器）
2. 寄存器将值 +1
3. 将值从寄存器保存回内存（寄存器->内存）



<details>

<summary>系统调用与库函数调用的区别?</summary>

<table><thead><tr><th width="120.7860107421875"></th><th>desc</th><th>feature</th></tr></thead><tbody><tr><td>System Call</td><td><p>操作系统提供的函数，</p><p>运行在<strong>内核态</strong>，通过「软中断」向内核态发出请求，执行较高硬件特权级别的指令</p></td><td>面向硬件、不可跨操作系统（分操作系统）、调用开销大（需要在用户空间和内核上下文环境切换）、不可替换、可访问所有内存地址</td></tr><tr><td>库函数</td><td><p>库函数是对系统调用上的一层包装，运行在<strong>用户态</strong>。</p><p>分为"有系统调用"和"无系统调用"</p></td><td>面向开发、移植性良好（不分操作系统）、开销小、可替换（底层实现是系统调用）、存在限制（只能访问特定范围内存地址）</td></tr></tbody></table>

</details>
