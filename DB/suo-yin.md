# 索引

## 覆盖索引聚集索引

按照主键构建一棵B+树，行记录数据放在叶子节点（16KB数据页）中

{% hint style="info" %}
在多数情况下，查询优化器倾向于采用聚集索引

* 能够在B+索引的叶子节点上直接找到数据
* 能够快速访问针对范围值的查询
{% endhint %}

## 非聚集索引

辅助索引，叶子节点存储的是聚集索引主键的key

<details>

<summary>为什么不放入数据而放入主键指针</summary>

1. 占用更多的磁盘空间
2. 数据更新时需要维护对所有索引树的更新

</details>

<table><thead><tr><th width="159.66668701171875"></th><th width="234.666748046875"></th><th></th></tr></thead><tbody><tr><td></td><td>聚集索引</td><td>非聚集索引</td></tr><tr><td>主键查询/物理存储</td><td>直接定位数据页（O(1) I/O）</td><td>需要二次回表查询（主键→数据页）</td></tr><tr><td>范围查询</td><td>顺序读取磁盘，效率高</td><td>离散读取，需要多次回表（多次I/O）</td></tr><tr><td></td><td></td><td>包含查询所需字段时可避免回表</td></tr><tr><td>插入性能</td><td>可能导致页分裂</td><td>仅更新索引树，开销较小</td></tr></tbody></table>

<details>

<summary>页剩余空间小于<strong>1/16</strong>（即15/16已满）时触发分裂，而不是1/32？</summary>

* 空间利用率仅增加约3%
* 但分裂频率上升40%（严重影响高并发写入）

</details>
