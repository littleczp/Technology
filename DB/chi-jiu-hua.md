# 持久化

<details>

<summary>Redis服务器默认会创建16个数据库</summary>

Redis客户端的目标数据库为0号数据库，但客户端可以通过执行 SELECT 命令来切换目标数据库

</details>



<details>

<summary>过期键删除策略</summary>

1. 惰性删除：程序只会在取出键时才对键进行过期检查
2. 定期删除



服务器以AOF持久化模式运行时，当过期键被惰性删除或者定期删除之后，程序会向AOF文件追加一跳DEL命令，来显式地记录该键已被删除



从服务器在执行客户端发送的读命令时，即使碰到过期键也不会执行删除。而是通过由主服务器来控制从服务器统一地删除过期键，这样可以保证主从服务器数据的一致性

</details>



{% tabs %}
{% tab title="RDB持久化" %}
通过SAVE（阻塞） & BGSAVE（子进程）生成RDB文件，

生成的RDB文件是一个压缩过的二进制文件（保存数据库中的键值对），通过该文件可以还原生成RDB文件时的数据库状态。



服务器在载入RDB文件期间，会一直处于阻塞状态，直到载入工作完成。
{% endtab %}

{% tab title="AOF持久化" %}
保存Redis服务器所执行的写命令来记录数据库状态



AOF文件的更新频率通常会比RDB文件的更新频率高，所以如果服务器开启了AOF持久化功能，会被优先使用来还原数据库状态。
{% endtab %}
{% endtabs %}



<details>

<summary>AOF重写</summary>

程序会对数据库中的键进行检查，已过期的键不会被保存到重写后的AOF文件中，

Ex：三个键k1，k2，k3并且k2已经过期，那么在进行重写工作时，程序只会对k1和k3进行重写，k2则会被忽略

</details>

